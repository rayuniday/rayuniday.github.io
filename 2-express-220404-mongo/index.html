<!doctype html>
<html data-n-head-ssr>
  <head>
    <title>RAYUN's TIL(Today I Learned)</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content="개발자 라윤의 TIL(Today I Learned)입니다."><meta data-n-head="ssr" name="format-detection" content="telephone=no"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/planet.png"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Gugi&display=swap"><link rel="preload" href="/_nuxt/0d858e3.js" as="script"><link rel="preload" href="/_nuxt/960bec5.js" as="script"><link rel="preload" href="/_nuxt/b5af4e1.js" as="script"><link rel="preload" href="/_nuxt/0bac3da.js" as="script"><link rel="preload" href="/_nuxt/58ef95b.js" as="script"><style data-vue-ssr-id="fa7ff0ca:0 0e80fc16:0 be47691e:0">.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}pre code.hljs[data-v-29962fe6]{display:block;overflow-x:auto;padding:1em}code.hljs[data-v-29962fe6]{padding:3px 5px}.hljs[data-v-29962fe6]{color:#abb2bf;background:#282c34}.hljs-comment[data-v-29962fe6],.hljs-quote[data-v-29962fe6]{color:#5c6370;font-style:italic}.hljs-doctag[data-v-29962fe6],.hljs-formula[data-v-29962fe6],.hljs-keyword[data-v-29962fe6]{color:#c678dd}.hljs-deletion[data-v-29962fe6],.hljs-name[data-v-29962fe6],.hljs-section[data-v-29962fe6],.hljs-selector-tag[data-v-29962fe6],.hljs-subst[data-v-29962fe6]{color:#e06c75}.hljs-literal[data-v-29962fe6]{color:#56b6c2}.hljs-addition[data-v-29962fe6],.hljs-attribute[data-v-29962fe6],.hljs-meta .hljs-string[data-v-29962fe6],.hljs-regexp[data-v-29962fe6],.hljs-string[data-v-29962fe6]{color:#98c379}.hljs-attr[data-v-29962fe6],.hljs-number[data-v-29962fe6],.hljs-selector-attr[data-v-29962fe6],.hljs-selector-class[data-v-29962fe6],.hljs-selector-pseudo[data-v-29962fe6],.hljs-template-variable[data-v-29962fe6],.hljs-type[data-v-29962fe6],.hljs-variable[data-v-29962fe6]{color:#d19a66}.hljs-bullet[data-v-29962fe6],.hljs-link[data-v-29962fe6],.hljs-meta[data-v-29962fe6],.hljs-selector-id[data-v-29962fe6],.hljs-symbol[data-v-29962fe6],.hljs-title[data-v-29962fe6]{color:#61aeee}.hljs-built_in[data-v-29962fe6],.hljs-class .hljs-title[data-v-29962fe6],.hljs-title.class_[data-v-29962fe6]{color:#e6c07b}.hljs-emphasis[data-v-29962fe6]{font-style:italic}.hljs-strong[data-v-29962fe6]{font-weight:700}.hljs-link[data-v-29962fe6]{text-decoration:underline}footer[data-v-29962fe6]{margin-top:30px;border-top:1px solid rgba(0,0,0,.1);display:flex;height:60px;align-items:center}footer a[data-v-29962fe6]{color:#ff7d7d;display:block;width:50%;padding:10px}footer a[data-v-29962fe6]:last-child{text-align:right}*{box-sizing:border-box;text-decoration:none;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif}body{margin:0}aside{position:fixed;top:0;border-right:1px solid rgba(0,0,0,.1);overflow-y:auto;height:100%;z-index:1;width:300px;background:#fff;color:#000333}@media screen and (max-width:800px){aside{position:inherit}}aside a{color:#000333;font-weight:400}aside a.isActive,aside a:hover{color:#ff7d7d}aside header{padding-top:30px}@media screen and (max-width:800px){aside header{top:0;display:flex;padding:0;height:60px;align-items:center;position:fixed;width:100%;background:#fff;border-bottom:1px solid rgba(0,0,0,.1);z-index:1}}aside header img{width:20px;cursor:pointer;margin-left:20px;margin-right:20px;display:none}@media screen and (max-width:800px){aside header img{display:block}}aside header a{display:block;text-align:center;font-size:1.3rem}aside nav{margin-top:20px;margin-bottom:20px;margin-right:20px}@media screen and (max-width:800px){aside nav{position:fixed;width:300px;border-right:1px solid rgba(0,0,0,.1);height:100%;top:60px;overflow-y:auto;margin:0;padding-right:20px;z-index:1;background:#fff}aside nav.isActive{display:none}}aside nav ul{list-style:none;padding:0;margin:0 0 0 20px}aside nav ul li{line-height:1.4}aside nav ul li a{display:block;margin-bottom:7px}aside nav ul p{font-weight:700;font-size:1.1rem;padding:0;margin:20px 0 8px}main{margin:0;padding-left:300px}@media screen and (max-width:800px){main{padding:60px 0 0}}main section{max-width:900px;margin:0 auto;padding:20px}main section h1{font-family:Gugi,cursive;font-size:5rem;border-bottom:17px solid #ff7d7d}</style><link rel="preload" href="/_nuxt/static/1649105225/2-express-220404-mongo/state.js" as="script"><link rel="preload" href="/_nuxt/static/1649105225/2-express-220404-mongo/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1649105225/manifest.js" as="script">
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div class="post__container" data-v-29962fe6><aside data-v-29962fe6><header><img src="data:image/svg+xml;base64,PHN2ZyBjbGFzcz0idy02IGgtNiIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJjdXJyZW50Q29sb3IiIHZpZXdCb3g9IjAgMCAyNCAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTQgNmgxNk00IDEyaDE2TTQgMThoMTYiPjwvcGF0aD48L3N2Zz4="> <a href="/">RAYUN's TIL</a></header> <nav class="isActive"><ul><li><p>2022년 Today I Learned</p> <ul><li><a href="/0-2022-today-i-learned">
              
            </a> <!----></li></ul></li><li><p>Project : 오늘 뭐 먹지?</p> <ul><li><a href="/1-project-220405-fridge-recipe">
              220405 개발 1일차
            </a> <!----></li></ul></li><li><p>Express</p> <ul><li><a href="/2-express-220401-setup">
              환경 설정
            </a> <!----></li><li><a href="/2-express-220402-server">
              서버 구축
            </a> <!----></li><li><a href="/2-express-220403-router">
              라우터(Router)
            </a> <!----></li><li><a href="/2-express-220404-mongo" aria-current="page" class="nuxt-link-exact-active nuxt-link-active isActive">
              MongoDB와 연결
            </a> <ul><li class="toc"><a href="/2-express-220404-mongo#edit">
                  Edit
                </a></li><li class="toc"><a href="/2-express-220404-mongo#mongodb-%EC%86%8C%EA%B0%9C">
                  MongoDB 소개
                </a></li><li class="toc"><a href="/2-express-220404-mongo#mongoose--connecting-to-mongo">
                  mongoose : Connecting to Mongo
                </a></li><li class="toc"><a href="/2-express-220404-mongo#crud">
                  CRUD
                </a></li><li class="toc"><a href="/2-express-220404-mongo#model">
                  Model
                </a></li><li class="toc"><a href="/2-express-220404-mongo#first-query">
                  First Query
                </a></li><li class="toc"><a href="/2-express-220404-mongo#%EB%B3%B8%EA%B2%A9-%EB%A7%8C%EB%93%A4%EA%B8%B0-%EC%8B%9C%EC%9E%91">
                  본격 만들기 시작
                </a></li></ul></li></ul></li><li><p>Music : Cover</p> <ul><li><a href="/7-music-cover-7-pop">
              POP
            </a> <!----></li><li><a href="/7-music-cover-8-ost">
              OST
            </a> <!----></li><li><a href="/7-music-cover-9-newage">
              뉴에이지
            </a> <!----></li></ul></li><li><p>Music : 클래식 피아노</p> <ul><li><a href="/8-music-classic-piano-beyer">
              바이엘
            </a> <!----></li><li><a href="/8-music-classic-piano-czerny">
              체르니 100 (Op.139)
            </a> <!----></li></ul></li><li><p>Music : 기타 연습</p> <ul><li><a href="/8-music-guitar">
              1일차
            </a> <!----></li></ul></li><li><p>Book</p> <ul><li><a href="/9-book-220401-twenty-ninth-birthday-decided">
              스물아홉 생일, 1년 후 죽기로 결심했다
            </a> <!----></li><li><a href="/9-book-220403-things-regret-now">
              지금 저지르지 않으면 후회할 일들
            </a> <!----></li><li><a href="/9-book-220404-things-knowing-regret">
              후회할 줄 알면서 저지르는 일들
            </a> <!----></li><li><a href="/9-book-220405">
              생각이 너무 많은 서른 살에게
            </a> <!----></li></ul></li><li><p>undefined</p> <ul><li><a href="/native-expo-cli">
              
            </a> <!----></li><li><a href="/nuxt-basic">
              
            </a> <!----></li><li><a href="/nuxt-content">
              
            </a> <!----></li><li><a href="/nuxt-sass">
              
            </a> <!----></li><li><a href="/react-basic">
              
            </a> <!----></li><li><a href="/scraping-request-bs4">
              
            </a> <!----></li><li><a href="/vue-220401-bottom-top">
              
            </a> <!----></li><li><a href="/vue-cli">
              
            </a> <!----></li></ul></li></ul></nav></aside> <main data-v-29962fe6><section data-v-29962fe6><h1 data-v-29962fe6>MongoDB와 연결</h1> <div class="nuxt-content" data-v-29962fe6 data-v-29962fe6><h2 id="edit" data-v-29962fe6 data-v-29962fe6><a aria-hidden="true" href="#edit" tabindex="-1" data-v-29962fe6 data-v-29962fe6><span class="icon icon-link" data-v-29962fe6 data-v-29962fe6></span></a>Edit</h2>
<p data-v-29962fe6 data-v-29962fe6>database를 바꿀 data를 보내거나, file을 보낼 때, 웹사이트에 로그인 할 때도 post를 사용하지. 로그인에는 get을 쓰지 않는다</p>
<div class="nuxt-content-highlight" data-v-29962fe6 data-v-29962fe6><pre data-v-29962fe6 data-v-29962fe6><code class="hljs js" data-v-29962fe6 data-v-29962fe6>videoRouter.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>get</span>(<span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"/:id(\\d+)/edit"</span>, getEdit);
videoRouter.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>post</span>(<span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"/:id(\\d+)/edit"</span>, postEdit);
</code></pre></div>
<div class="nuxt-content-highlight" data-v-29962fe6 data-v-29962fe6><pre data-v-29962fe6 data-v-29962fe6><code class="hljs js" data-v-29962fe6 data-v-29962fe6>videoRouter.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>route</span>(<span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"/:id(\\d+)/edit"</span>).<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>get</span>(getEdit).<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>post</span>(postEdit);
</code></pre></div>
<p data-v-29962fe6 data-v-29962fe6>urlencoded : form의 body를 이해</p>
<ul data-v-29962fe6 data-v-29962fe6>
<li data-v-29962fe6 data-v-29962fe6>options
<ul data-v-29962fe6 data-v-29962fe6>
<li data-v-29962fe6 data-v-29962fe6>parameterLimit : parameter 갯수에 제한</li>
<li data-v-29962fe6 data-v-29962fe6>limit : form의 사이즈를 제한</li>
<li data-v-29962fe6 data-v-29962fe6>extended</li>
</ul>
</li>
</ul>
<div class="nuxt-content-highlight" data-v-29962fe6 data-v-29962fe6><pre data-v-29962fe6 data-v-29962fe6><code class="hljs js" data-v-29962fe6 data-v-29962fe6>app.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>use</span>(express.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>urlencoded</span>({ <span class="hljs-attr" data-v-29962fe6 data-v-29962fe6>extended</span>: <span class="hljs-literal" data-v-29962fe6 data-v-29962fe6>true</span> }));
</code></pre></div>
<p data-v-29962fe6 data-v-29962fe6>express application가 form의 value들을 이해할 수 있도록 하고, 멋진 자바스크립트 형식으로 변형</p>
<p data-v-29962fe6 data-v-29962fe6>보통 2개 이상의 method를 사용하는 게 아니면, route는 사용하지 않는다.</p>
<p data-v-29962fe6 data-v-29962fe6>req.body</p>
<ul data-v-29962fe6 data-v-29962fe6>
<li data-v-29962fe6 data-v-29962fe6>form에 있는 value의 javascript representation</li>
<li data-v-29962fe6 data-v-29962fe6>middleware 설정해야 가능 : <code data-v-29962fe6 data-v-29962fe6>app.use(express.urlencoded({ extended: true }));</code>
<ul data-v-29962fe6 data-v-29962fe6>
<li data-v-29962fe6 data-v-29962fe6>form을 우리가 사용할 수 있는 javascript object 형식으로 통역</li>
<li data-v-29962fe6 data-v-29962fe6>router 전에 있어야 함</li>
</ul>
</li>
<li data-v-29962fe6 data-v-29962fe6>form - input : name이 있어야 값이 들어감</li>
</ul>
<p data-v-29962fe6 data-v-29962fe6>mongodb : mongodb.com
mongoose : mongoosejs.com</p>
<ul data-v-29962fe6 data-v-29962fe6>
<li data-v-29962fe6 data-v-29962fe6>자바스크립트에서 mongodb와 상호작용</li>
</ul>
<p data-v-29962fe6 data-v-29962fe6>유저가 form을 get 하고, 그 form을 post 하면, controller를 발동시켜서 유저들이 redirect되거나, 페이지에서 뭔가를 보게 된다.</p>
<h2 id="mongodb-소개" data-v-29962fe6 data-v-29962fe6><a aria-hidden="true" href="#mongodb-%EC%86%8C%EA%B0%9C" tabindex="-1" data-v-29962fe6 data-v-29962fe6><span class="icon icon-link" data-v-29962fe6 data-v-29962fe6></span></a>MongoDB 소개</h2>
<p data-v-29962fe6 data-v-29962fe6>mongodb.com</p>
<p data-v-29962fe6 data-v-29962fe6>다목적용이고, document을 기반</p>
<p data-v-29962fe6 data-v-29962fe6>document-based</p>
<p data-v-29962fe6 data-v-29962fe6>현대의 애플리케이션 개발자를 위해 만들어진 분산 데이터베이스
일반 데이터베이스는 sql-based : 행 기반이라고 할 수 있는데, 엑셀 시트와 같은 것
당신은 프로그래머로서, object로 생각한다
mongoDB에서 저장하는 것들은 JSON-like-document. 그러므로 행으로 된 데이터를 저장할 필요가 없다
mongoDB는 document 내부를 검색할 수 있도록 해준다.
community edition은 무료
Window</p>
<ol data-v-29962fe6 data-v-29962fe6>
<li data-v-29962fe6 data-v-29962fe6>여기에 있는 installer를 다운로드</li>
<li data-v-29962fe6 data-v-29962fe6>mongoDB installer를 실행시키고</li>
<li data-v-29962fe6 data-v-29962fe6>.msi 파일을 클릭하고, setup type 선택해주고</li>
<li data-v-29962fe6 data-v-29962fe6>next 버튼 계속 눌러주면 된다.</li>
<li data-v-29962fe6 data-v-29962fe6>data directory랑 log directory에 대해 물을 텐데 대부분 자동으로 입력되어 있다.</li>
<li data-v-29962fe6 data-v-29962fe6>install 버튼을 눌러주면 된다.
chocolately로 다운로드 하는 방법도 있다. 이건 더 간편!</li>
</ol>
<h2 id="mongoose--connecting-to-mongo" data-v-29962fe6 data-v-29962fe6><a aria-hidden="true" href="#mongoose--connecting-to-mongo" tabindex="-1" data-v-29962fe6 data-v-29962fe6><span class="icon icon-link" data-v-29962fe6 data-v-29962fe6></span></a>mongoose : Connecting to Mongo</h2>
<p data-v-29962fe6 data-v-29962fe6>mongoosejs.com
node.js와 mongoDB를 이어주는 다리
자바스크립트를 적으면, mongoose가 mongoDB에게 전해준다.</p>
<p data-v-29962fe6 data-v-29962fe6>mongod
mongo
help : 명령어를 보여줌
show dbs
exit</p>
<div class="nuxt-content-highlight" data-v-29962fe6 data-v-29962fe6><pre data-v-29962fe6 data-v-29962fe6><code class="hljs cmd" data-v-29962fe6 data-v-29962fe6>npm i mongoose
</code></pre></div>
<p data-v-29962fe6 data-v-29962fe6>mongodb://127.0.0.1:27017:database가 실행되고 있는 url
mongo 명령어를 console에서 실행시켜서, 이 url을 받아야 한다.</p>
<p data-v-29962fe6 data-v-29962fe6>src/db.js</p>
<div class="nuxt-content-highlight" data-v-29962fe6 data-v-29962fe6><pre data-v-29962fe6 data-v-29962fe6><code class="hljs js" data-v-29962fe6 data-v-29962fe6><span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>import</span> mongoose <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>from</span> <span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"mongoose"</span>;

mongoose.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>connect</span>(<span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"mongodb://127.0.0.1:27017/Databse이름"</span>);

<span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>const</span> db = mongoose.<span class="hljs-property" data-v-29962fe6 data-v-29962fe6>connection</span>;

<span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>const</span> <span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>handleOpen</span> = (<span class="hljs-params" data-v-29962fe6 data-v-29962fe6></span>) => <span class="hljs-variable language_" data-v-29962fe6 data-v-29962fe6>console</span>.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>log</span>(<span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"Connected to DB"</span>);
<span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>const</span> <span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>handleError</span> = (<span class="hljs-params" data-v-29962fe6 data-v-29962fe6>error</span>) => <span class="hljs-variable language_" data-v-29962fe6 data-v-29962fe6>console</span>.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>log</span>(<span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"DB Error"</span>, error);

db.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>on</span>(<span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"error"</span>, handleError);
db.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>once</span>(<span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"open"</span>, handleOpen);
</code></pre></div>
<p data-v-29962fe6 data-v-29962fe6>src/server.js</p>
<div class="nuxt-content-highlight" data-v-29962fe6 data-v-29962fe6><pre data-v-29962fe6 data-v-29962fe6><code class="hljs js" data-v-29962fe6 data-v-29962fe6><span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>import</span> <span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"./db"</span>;
</code></pre></div>
<h2 id="crud" data-v-29962fe6 data-v-29962fe6><a aria-hidden="true" href="#crud" tabindex="-1" data-v-29962fe6 data-v-29962fe6><span class="icon icon-link" data-v-29962fe6 data-v-29962fe6></span></a>CRUD</h2>
<p data-v-29962fe6 data-v-29962fe6>C : create (생성)
R : read (읽기)
U : update (수정)
D : delete (삭제)</p>
<p data-v-29962fe6 data-v-29962fe6>mongoose에게 우리 애플리케이션의 데이터들이 어떻게 생겼는지 알려줘야헤
mongoose는 데이터를 만들고, 삭제하고, 수정하고, 검색하는 걸 도와줄거야
database가 model을 만들고, model을 검색하고, 삭제하고, 수정하는 걸 도와줄 수 있어</p>
<h2 id="model" data-v-29962fe6 data-v-29962fe6><a aria-hidden="true" href="#model" tabindex="-1" data-v-29962fe6 data-v-29962fe6><span class="icon icon-link" data-v-29962fe6 data-v-29962fe6></span></a>Model</h2>
<p data-v-29962fe6 data-v-29962fe6>model을 만들기 위해선 먼저 mongoose를 mongoose에서 import 해야해
model을 생성하기 전에 model의 형태를 정의해 줄 필요가 있어
schema라고 알려져 있어
작성한 코드 안에 내 비디오 형식을 작성할거야
실제 데이터는 안 넣을 거고 형식만 정의해줄 거야
예를 들어 비디오의 title과 그 데이터 형식을 정하는 것</p>
<p data-v-29962fe6 data-v-29962fe6>model 폴더 생성</p>
<div class="nuxt-content-highlight" data-v-29962fe6 data-v-29962fe6><pre data-v-29962fe6 data-v-29962fe6><code class="hljs js" data-v-29962fe6 data-v-29962fe6><span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>import</span> mongoose <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>from</span> <span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"mongoose"</span>;

<span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>const</span> videoSchema = <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>new</span> mongoose.<span class="hljs-title class_" data-v-29962fe6 data-v-29962fe6>Schema</span>({
  <span class="hljs-attr" data-v-29962fe6 data-v-29962fe6>title</span>: <span class="hljs-title class_" data-v-29962fe6 data-v-29962fe6>String</span>,
  <span class="hljs-attr" data-v-29962fe6 data-v-29962fe6>description</span>: <span class="hljs-title class_" data-v-29962fe6 data-v-29962fe6>String</span>,
  <span class="hljs-attr" data-v-29962fe6 data-v-29962fe6>createdAt</span>: <span class="hljs-title class_" data-v-29962fe6 data-v-29962fe6>Date</span>,
  <span class="hljs-attr" data-v-29962fe6 data-v-29962fe6>hashtags</span>: [{ <span class="hljs-attr" data-v-29962fe6 data-v-29962fe6>type</span>: <span class="hljs-title class_" data-v-29962fe6 data-v-29962fe6>String</span> }],
  <span class="hljs-attr" data-v-29962fe6 data-v-29962fe6>meta</span>: {
    <span class="hljs-attr" data-v-29962fe6 data-v-29962fe6>views</span>: <span class="hljs-title class_" data-v-29962fe6 data-v-29962fe6>Number</span>,
    <span class="hljs-attr" data-v-29962fe6 data-v-29962fe6>rating</span>: <span class="hljs-title class_" data-v-29962fe6 data-v-29962fe6>Number</span>,
  },
});

<span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>const</span> <span class="hljs-title class_" data-v-29962fe6 data-v-29962fe6>Video</span> = mongoose.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>model</span>(<span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"Video"</span>, videoSchema);
<span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>export</span> <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>default</span> <span class="hljs-title class_" data-v-29962fe6 data-v-29962fe6>Video</span>;
</code></pre></div>
<p data-v-29962fe6 data-v-29962fe6>src/server.js</p>
<div class="nuxt-content-highlight" data-v-29962fe6 data-v-29962fe6><pre data-v-29962fe6 data-v-29962fe6><code class="hljs js" data-v-29962fe6 data-v-29962fe6><span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>import</span> <span class="hljs-title class_" data-v-29962fe6 data-v-29962fe6>Video</span> <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>from</span> <span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"./models/Video"</span>;
<span class="hljs-comment" data-v-29962fe6 data-v-29962fe6>//or</span>
<span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>import</span> <span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"./models/Video"</span>;
</code></pre></div>
<h2 id="first-query" data-v-29962fe6 data-v-29962fe6><a aria-hidden="true" href="#first-query" tabindex="-1" data-v-29962fe6 data-v-29962fe6><span class="icon icon-link" data-v-29962fe6 data-v-29962fe6></span></a>First Query</h2>
<p data-v-29962fe6 data-v-29962fe6>server.js는 server 관련 코드만 처리하고
init.js는 필요한 모든 것들을 import 시키는 역할을 담당</p>
<p data-v-29962fe6 data-v-29962fe6>init.js</p>
<div class="nuxt-content-highlight" data-v-29962fe6 data-v-29962fe6><pre data-v-29962fe6 data-v-29962fe6><code class="hljs js" data-v-29962fe6 data-v-29962fe6><span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>import</span> <span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"./db"</span>;
<span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>import</span> <span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"./models/Video"</span>;
<span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>import</span> <span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"./models/User"</span>;
<span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>import</span> app <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>from</span> <span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"./server"</span>;

<span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>const</span> <span class="hljs-variable constant_" data-v-29962fe6 data-v-29962fe6>PORT</span> = <span class="hljs-number" data-v-29962fe6 data-v-29962fe6>4000</span>;

<span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>const</span> <span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>handleListening</span> = (<span class="hljs-params" data-v-29962fe6 data-v-29962fe6></span>) =>
  <span class="hljs-variable language_" data-v-29962fe6 data-v-29962fe6>console</span>.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>log</span>(<span class="hljs-string" data-v-29962fe6 data-v-29962fe6>`Server listening on http://localhost:<span class="hljs-subst" data-v-29962fe6 data-v-29962fe6>${PORT}</span>`</span>);

app.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>listen</span>(<span class="hljs-variable constant_" data-v-29962fe6 data-v-29962fe6>PORT</span>, handleListening);
</code></pre></div>
<p data-v-29962fe6 data-v-29962fe6>server.js</p>
<div class="nuxt-content-highlight" data-v-29962fe6 data-v-29962fe6><pre data-v-29962fe6 data-v-29962fe6><code class="hljs js" data-v-29962fe6 data-v-29962fe6><span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>import</span> express <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>from</span> <span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"express"</span>;
<span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>import</span> morgan <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>from</span> <span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"morgan"</span>;

<span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>import</span> rootRouter <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>from</span> <span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"./routers/rootRouter"</span>;
<span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>import</span> videoRouter <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>from</span> <span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"./routers/videoRouter"</span>;
<span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>import</span> userRouter <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>from</span> <span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"./routers/userRouter"</span>;
<span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>import</span> apiRouter <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>from</span> <span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"./routers/apiRouter"</span>;

<span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>const</span> app = <span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>express</span>();
<span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>const</span> logger = <span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>morgan</span>(<span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"dev"</span>);

app.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>set</span>(<span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"view engine"</span>, <span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"pug"</span>);
app.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>set</span>(<span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"views"</span>, process.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>cwd</span>() + <span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"/src/views"</span>);
app.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>use</span>(logger);
app.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>use</span>(express.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>urlencoded</span>({ <span class="hljs-attr" data-v-29962fe6 data-v-29962fe6>extended</span>: <span class="hljs-literal" data-v-29962fe6 data-v-29962fe6>true</span> }));
app.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>use</span>(<span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"/"</span>, rootRouter);
app.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>use</span>(<span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"/videos"</span>, videoRouter);
app.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>use</span>(<span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"/users"</span>, userRouter);
app.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>use</span>(<span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"/api"</span>, apiRouter);

<span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>export</span> <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>default</span> app;
</code></pre></div>
<p data-v-29962fe6 data-v-29962fe6>mongoosejs.com/docs/queries.html</p>
<p data-v-29962fe6 data-v-29962fe6>callback은 특별한 것이 아니라 javascript에서 기다림을 표현하는 하나의 방법이라 생각하면 편해
app.listen(PORT, handleListening) : 여기서도 연결이 확인되면 특정 function이 발동하는 것
내가 무언가가 발생한 다음(then) 어떤 것을 한다는 식의 말을 계속 하고 있는데 어떤 것들은 실행과 동시에 적용되지 않기 떄문이야
javascript 파일 속에 없는 데이터 이것이 바로 database라는 거야
다양한 상황에 따라 데이터 처리에 시간이 걸릴 수도 있음
call back 방식
{} : search terms가 비어있으면 모든 형식을 찾는다는 것을 뜻해
callback은 error와 docs라는 signature를 가져</p>
<div class="nuxt-content-highlight" data-v-29962fe6 data-v-29962fe6><pre data-v-29962fe6 data-v-29962fe6><code class="hljs js" data-v-29962fe6 data-v-29962fe6><span class="hljs-title class_" data-v-29962fe6 data-v-29962fe6>Recipe</span>.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>find</span>({}, <span class="hljs-function" data-v-29962fe6 data-v-29962fe6>(<span class="hljs-params" data-v-29962fe6 data-v-29962fe6>error, recipe</span>) =></span> {});

<span class="hljs-comment" data-v-29962fe6 data-v-29962fe6>// ---></span>
</code></pre></div>
<div class="nuxt-content-highlight" data-v-29962fe6 data-v-29962fe6><pre data-v-29962fe6 data-v-29962fe6><code class="hljs js" data-v-29962fe6 data-v-29962fe6><span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>export</span> <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>const</span> <span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>view</span> = <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>async</span> (<span class="hljs-params" data-v-29962fe6 data-v-29962fe6>req, res</span>) => {
  <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>const</span> recipes = <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>await</span> <span class="hljs-title class_" data-v-29962fe6 data-v-29962fe6>Recipe</span>.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>find</span>({});
  <span class="hljs-variable language_" data-v-29962fe6 data-v-29962fe6>console</span>.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>log</span>(recipes);
  <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>return</span> res.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>send</span>(<span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"recipe view"</span>);
};
</code></pre></div>
<hr data-v-29962fe6 data-v-29962fe6>
<h2 id="본격-만들기-시작" data-v-29962fe6 data-v-29962fe6><a aria-hidden="true" href="#%EB%B3%B8%EA%B2%A9-%EB%A7%8C%EB%93%A4%EA%B8%B0-%EC%8B%9C%EC%9E%91" tabindex="-1" data-v-29962fe6 data-v-29962fe6><span class="icon icon-link" data-v-29962fe6 data-v-29962fe6></span></a>본격 만들기 시작</h2>
<p data-v-29962fe6 data-v-29962fe6>list 불러오는 controller</p>
<div class="nuxt-content-highlight" data-v-29962fe6 data-v-29962fe6><pre data-v-29962fe6 data-v-29962fe6><code class="hljs js" data-v-29962fe6 data-v-29962fe6><span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>export</span> <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>const</span> <span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>list</span> = <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>async</span> (<span class="hljs-params" data-v-29962fe6 data-v-29962fe6>req, res</span>) => {
  <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>try</span> {
    <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>const</span> recipes = <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>await</span> <span class="hljs-title class_" data-v-29962fe6 data-v-29962fe6>Recipe</span>.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>find</span>({});
    <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>return</span> res.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>send</span>(recipes);
  } <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>catch</span> (error) {
    <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>return</span> res.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>send</span>(error);
  }
};
</code></pre></div>
<p data-v-29962fe6 data-v-29962fe6>create</p>
<div class="nuxt-content-highlight" data-v-29962fe6 data-v-29962fe6><pre data-v-29962fe6 data-v-29962fe6><code class="hljs js" data-v-29962fe6 data-v-29962fe6><span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>export</span> <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>const</span> <span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>create</span> = <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>async</span> (<span class="hljs-params" data-v-29962fe6 data-v-29962fe6>req, res</span>) => {
  <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>try</span> {
    <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>const</span> { title, ingredient, step } = req.<span class="hljs-property" data-v-29962fe6 data-v-29962fe6>body</span>;
    <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>const</span> recipe = <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>new</span> <span class="hljs-title class_" data-v-29962fe6 data-v-29962fe6>Recipe</span>({
      title,
      ingredient,
      step,
    });
    <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>const</span> dbRecipe = <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>await</span> recipe.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>save</span>();
    <span class="hljs-variable language_" data-v-29962fe6 data-v-29962fe6>console</span>.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>log</span>(dbRecipe);
    <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>return</span> res.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>send</span>(<span class="hljs-string" data-v-29962fe6 data-v-29962fe6>"추가"</span>);
  } <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>catch</span> (error) {
    <span class="hljs-keyword" data-v-29962fe6 data-v-29962fe6>return</span> res.<span class="hljs-title function_" data-v-29962fe6 data-v-29962fe6>send</span>(error);
  }
};
</code></pre></div></div> <footer data-v-29962fe6><a href="/2-express-220403-router" data-v-29962fe6>← 라우터(Router)</a> <a href="/7-music-cover-7-pop" data-v-29962fe6>POP →</a></footer></section></main></div></div></div><script defer src="/_nuxt/static/1649105225/2-express-220404-mongo/state.js"></script><script src="/_nuxt/0d858e3.js" defer></script><script src="/_nuxt/58ef95b.js" defer></script><script src="/_nuxt/960bec5.js" defer></script><script src="/_nuxt/b5af4e1.js" defer></script><script src="/_nuxt/0bac3da.js" defer></script>
  </body>
</html>
